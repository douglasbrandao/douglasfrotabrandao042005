<div class="min-h-screen px-4 sm:px-6 lg:px-8 pb-8 sm:pb-10">
  <div class="max-w-4xl mx-auto">
    <div class="flex flex-wrap items-center gap-3 sm:gap-4 mb-6 sm:mb-8 mt-4 sm:mt-6">
      <button (click)="back()" class="btn-secondary min-h-[44px] sm:min-h-0">← Voltar</button>
      <button (click)="openEdit()" class="btn-primary min-h-[44px] sm:min-h-0">Editar tutor</button>
    </div>

    @if (loading()) {
      <div class="flex justify-center items-center py-12 sm:py-16 text-base sm:text-lg text-[var(--color-secondary)]">Carregando...</div>
    }

    @if (errorMessage()) {
      <div class="alert-error">{{ errorMessage() }}</div>
    }

    @if (!loading() && tutor()) {
      <div class="card-base bg-white w-full max-w-2xl sm:max-w-3xl lg:max-w-4xl mx-auto p-6 sm:p-8 lg:p-10 flex flex-col items-center gap-6 sm:gap-8 shadow-2xl mb-8 sm:mb-12">
          <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-[var(--color-secondary)] text-center mb-2 truncate w-full min-w-0 capitalize" [title]="tutor()?.nome || 'Sem nome'">{{ tutor()?.nome || 'Sem nome' }}</h1>
          <app-avatar [src]="avatarSrc()" [alt]="tutor()?.nome ?? ''" size="lg">Sem foto</app-avatar>
            <div class="w-full min-w-0 flex flex-col gap-1 text-[var(--color-secondary)]/90 text-base sm:text-lg">
            <p class="truncate capitalize" [title]="tutor()?.telefone || 'Sem telefone'"><span class="font-semibold">Telefone:</span> {{ tutor()?.telefone || 'Sem telefone' }}</p>
            <p class="break-words capitalize" [title]="tutor()?.endereco || 'Sem endereço'"><span class="font-semibold">Endereço:</span> {{ tutor()?.endereco || 'Sem endereço' }}</p>
          </div>
          <div class="w-full min-w-0 border-t border-[var(--color-primary)]/30 pt-4 sm:pt-6 mt-2 sm:mt-4">
            <h2 class="text-xl sm:text-2xl font-bold text-[var(--color-primary)] mb-2">Pets</h2>
            @if ((tutor()?.pets ?? []).length > 0) {
            <ul class="list-disc ml-4 sm:ml-5 mt-2 text-[var(--color-secondary)]/80 space-y-1 text-sm sm:text-base">
                @for (p of tutor()?.pets ?? []; track p?.id) {
                <li class="break-words capitalize">
                    <a [routerLink]="['/pet', p?.id]" class="text-[var(--color-primary)] hover:underline">{{ p?.nome || 'Sem nome' }}</a>
                    <span class="text-[var(--color-secondary)]/70"> — {{ p?.raca || 'Sem raça' }}</span>
                </li>
              }
            </ul>
            } @else {
              <p class="text-[var(--color-secondary)]/80 text-sm sm:text-base mt-2">Nenhum pet vinculado.</p>
            }
          </div>
      </div>
    }

      @if (showEdit()) {
        <app-modal [open]="showEdit()" (close)="closeEdit()">
          <div class="p-2">
            <h3 class="text-xl font-bold mb-4">Editar tutor</h3>
            <form (ngSubmit)="save()" [formGroup]="editForm" class="grid grid-cols-1 gap-4">
              <div class="flex flex-col items-center gap-2 mb-2">
                <label class="block text-sm font-semibold mb-1">Foto do tutor</label>
                <div class="relative">
                  <app-avatar [src]="avatarSrc()" [alt]="editForm.get('nome')?.value || ''" size="md">Sem foto</app-avatar>
                  <input type="file" accept="image/*" (change)="onAvatarChange($event)" class="absolute inset-0 opacity-0 cursor-pointer w-24 h-24" />
                </div>
              </div>
              <div>
                <label class="label">Nome</label>
                <input class="input-base" formControlName="nome" />
              </div>
              <div>
                <label class="label">Telefone</label>
                <input class="input-base" formControlName="telefone" />
              </div>
              <div>
                <label class="label">Endereço</label>
                <input class="input-base" formControlName="endereco" />
              </div>
              <div>
                <label class="block text-sm font-semibold mb-1">Pets</label>
                <div class="rounded-xl p-3 bg-gray-50">
                  <div class="mb-3">
                    <span class="text-sm text-[var(--color-secondary)]/70">Pets disponíveis</span>
                  </div>
                  <app-pet-selector [pets]="allPets()" [selected]="selectedPets()" (selectedChange)="onSelectedChange($event)"></app-pet-selector>
                  @if (selectedPets().length === 0) {
                    <div class="text-xs text-[var(--color-secondary)]/60 mt-1">Nenhum pet selecionado</div>
                  } @else {
                    <div class="text-xs text-[var(--color-secondary)]/70 mt-1">{{ selectedPets().length }} pet(s) selecionado(s)</div>
                  }
                  @if (editForm.get('pets')?.touched && editForm.get('pets')?.invalid) {
                    <div class="text-xs text-red-600 mt-1">Selecione ao menos um pet</div>
                  }
                </div>
              </div>
              <div class="flex justify-end gap-2 pt-2">
                <button type="button" (click)="closeEdit()" class="btn-secondary">Cancelar</button>
                <button type="submit" class="btn-primary">Salvar</button>
              </div>
            </form>
          </div>
        </app-modal>
      }
  </div>
</div>
