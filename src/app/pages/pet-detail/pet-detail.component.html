<div class="w-full px-2 mt-8">
  <div class="w-full max-w-3xl mx-auto">
    <div class="flex items-center gap-4 mb-8">
      <button (click)="goBack()" class="btn-secondary">
        ← Voltar
      </button>
      <button (click)="openEditModal()" class="btn-primary">
        Editar pet
      </button>
    </div>
    @if (loading()) {
      <div class="flex justify-center items-center py-12 text-lg text-[var(--color-secondary)]">Carregando...</div>
    }
    @if (errorMessage()) {
      <div class="bg-red-100 text-red-700 px-4 py-2 rounded mb-4 text-center">{{ errorMessage() }}</div>
    }
    <app-modal [open]="isEditModalOpen()" (close)="closeEditModal()" width="max-w-md">
      <h2 class="text-2xl font-bold mb-4 text-[var(--color-primary)]">Editar pet</h2>
      @if (errorMessage() && isEditModalOpen()) {
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded flex items-center gap-2 mb-2">
          <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01M21 12A9 9 0 1 1 3 12a9 9 0 0 1 18 0Z"/></svg>
          <span>{{ errorMessage() }}</span>
        </div>
      }
      <form [formGroup]="editForm" (ngSubmit)="submitEdit()" class="space-y-4">
        <div class="flex flex-col items-center gap-2 mb-2">
          <label class="block text-sm font-semibold mb-1">Foto do pet</label>
          <div class="relative">
            <app-avatar [src]="avatarSrc()" [alt]="pet()?.nome || ''" size="md">Sem foto</app-avatar>
            <input type="file" accept="image/*" (change)="onAvatarChange($event)" class="absolute inset-0 opacity-0 cursor-pointer w-24 h-24" />
          </div>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Nome</label>
          <input type="text" formControlName="nome" class="input-base w-full" />
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Idade</label>
          <input type="number" formControlName="idade" class="input-base w-full" min="0" />
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Raça</label>
          <input type="text" formControlName="raca" class="input-base w-full" />
        </div>
        <div class="flex justify-end gap-2 pt-2">
          <button type="button" (click)="closeEditModal()" class="btn-secondary">Cancelar</button>
          <button type="submit" class="btn-primary">Salvar</button>
        </div>
      </form>
    </app-modal>
    @if (pet() && !loading()) {
      <div class="card-base bg-white w-full max-w-2xl mx-auto p-10 flex flex-col items-center gap-8 shadow-2xl mb-12">
        <h1 class="text-5xl font-extrabold text-[var(--color-secondary)] text-center mb-2">{{ pet()?.nome }}</h1>
        <app-avatar [src]="pet()?.foto?.url ?? null" [alt]="pet()?.nome || ''" size="lg">Sem foto</app-avatar>
        <div class="w-full flex flex-col gap-1 text-[var(--color-secondary)]/90 text-lg">
          <p><span class="font-semibold">Raça:</span> {{ pet()?.raca }}</p>
          <p><span class="font-semibold">Idade:</span> {{ pet()?.idade }} anos</p>
        </div>
        @if (tutor()) {
          <div class="w-full border-t pt-6 mt-4">
            <h2 class="text-2xl font-bold text-[var(--color-primary)] mb-2">Tutor</h2>
            <p class="text-lg"><span class="font-semibold">Nome:</span> {{ tutor()?.nome }}</p>
            <p class="text-lg"><span class="font-semibold">Contato:</span> {{ tutor()?.contato }}</p>
          </div>
        }
      </div>
    }
  </div>
</div>
